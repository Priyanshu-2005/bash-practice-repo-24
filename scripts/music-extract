#!/bin/bash

if [ "$#" -ne 1 ]; then
    echo "Kindly enter the Folder name as argument"
    exit 1
fi
input_directory="$1"

declare -a mp4_files=()
while IFS= read -r -d '' file; do
    mp4_files+=("$file")
done < <(find "$input_directory" -type f -name "*.mp4" -print0)

if [ ${#mp4_files[@]} -eq 0 ]; then
    echo "No MP4 files found in '$input_directory' or its subdirectories."
    exit 0
fi

for mp4_file in "${mp4_files[@]}"; do
    output_file="${mp4_file%.mp4}.mp3"
    
    output_dir=$(dirname "$output_file")
    mkdir -p "$output_dir"
    
    ffmpeg -i "$mp4_file" -vn -acodec libmp3lame -q:a 2 "$output_file"
    
    if [ $? -eq 0 ]; then
        echo "Conversion successful: $mp4_file -> $output_file"
    else
        echo "Error: Conversion failed for '$mp4_file'."
    fi
done